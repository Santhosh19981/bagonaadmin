<div class="admin-dashboard">
  <!-- SIDEBAR -->
  <app-sidemenu [menuFromParent]="'menuitems'"></app-sidemenu>

  <!-- CONTENT -->
  <section id="content">

    <!-- NAVBAR -->
    <nav></nav>
    <!-- NAVBAR -->

    <!-- MAIN -->
    <main>

      <!-- ====================== FORM SECTION ====================== -->
      <div class="container" *ngIf="showForm">
        <div class="row">
          <div class="col-sm-5">
            <div class="create-header">
              <div class="d-flex justify-content-between align-items-center mb-3">
              <h3>{{ selectedMenuItem ? 'Edit Menu Item' : 'Create Menu Item' }}</h3>
              <button type="button" class="admin-btn btn-soft-danger" (click)="toggleForm()">
                  Back
                </button>
                </div>

              <form class="form-horizontal" (ngSubmit)="saveMenuItem()">

                <!-- Image Upload -->
                <div class="form-group">
                  <label>Item Image</label>
                  <input
                    class="form-control user"
                    type="file"
                    accept="image/*"
                    (change)="onImageChange($event)"
                    [required]="!selectedMenuItem"
                  />

                  <!-- IMAGE PREVIEW -->
                  <div class="mt-2" *ngIf="imagePreview">
                    <img [src]="imagePreview" width="120" height="120" class="rounded" />
                  </div>
                </div>

                <!-- Item Name -->
                <div class="form-group">
                  <label>Item Name</label>
                  <input
                    class="form-control user"
                    type="text"
                    placeholder="Item Name"
                    [(ngModel)]="newMenuItem.name"
                    name="name"
                    required
                  />
                </div>

                <!-- Type -->
                <div class="form-group">
                  <label>Type</label>
                  <select
                    class="form-control"
                    [(ngModel)]="newMenuItem.type"
                    name="type"
                    required
                  >
                    <option value="" disabled>Select type</option>
                    <option value="Veg">Veg</option>
                    <option value="Non-Veg">Non-Veg</option>
                  </select>
                </div>

                <!-- Buttons -->
                <button class="custom-btn btn-7 mt-2 me-2" type="button" (click)="toggleForm()">
                  <span>Back</span>
                </button>

                <button class="custom-btn btn-7 mt-2" type="submit">
                  <span>Save</span>
                </button>

              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- ====================== TABLE SECTION ====================== -->
      <div class="table-data" *ngIf="!showForm">

        <div class="order">
          <div class="head">
            <h3>Menu Items List</h3>

            <div>
              <a class="admin-btn btn-7 text-decoration-none" (click)="toggleForm()">Add</a>
            </div>

            <form>
              <div class="form-input">
                <input type="search" placeholder="Search..." />
                <button type="submit" class="search-btn">
                  <i class="bx bx-search"></i>
                </button>
              </div>
            </form>
          </div>

          <div class="overflow-auto pr-1 relative h-[calc(100dvh_-_375px)]">
            <table>
              <thead>
                <tr>
                  <th>Image</th>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Action</th>
                </tr>
              </thead>

              <tbody>
                <tr *ngFor="let item of menuitems">

                  <!-- IMAGE WITH FALLBACK -->
                  <td>
                    <img
                      [src]="item.image"
                      (error)="onImageError($event)"
                      width="50"
                      height="50"
                      class="rounded"
                    />
                  </td>

                  <td>{{ item.name }}</td>

                  <td>
                    <span
                      class="status"
                      [ngClass]="{
                        'completed': item.type === 'Veg',
                        'pending': item.type === 'Non-Veg'
                      }"
                    >
                      {{ item.type }}
                    </span>
                  </td>

                  <td>
                    <div class="inline-flex gap-2">
                      <!-- EDIT -->
                      <a class="admin-btn btn-soft-primary" (click)="toggleForm(item)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"
                          viewBox="0 0 24 24">
                          <path
                            fill="none"
                            stroke="currentColor"
                            stroke-linecap="round"
                            stroke-width="1.5"
                            d="M4 22h4m12 0h-8m1.888-18.337l.742-.742a3.146 3.146 0 1 1 4.449 4.45l-.742.74m-4.449-4.448s.093 1.576 1.483 2.966s2.966 1.483 2.966 1.483m-4.449-4.45L7.071 10.48c-.462.462-.693.692-.891.947a5.2 5.2 0 0 0-.599.969c-.139.291-.242.601-.449 1.22l-.875 2.626m14.08-8.13L14.93 11.52m-3.41 3.41c-.462.462-.692.692-.947.891q-.451.352-.969.599c-.291.139-.601.242-1.22.448l-2.626.876m0 0l-.641.213a.848.848 0 0 1-1.073-1.073l.213-.641m1.501 1.5l-1.5-1.5"
                          />
                        </svg>
                      </a>

                      <!-- DELETE -->
                      <a class="admin-btn btn-soft-danger" (click)="deleteMenuItem(item.id!)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"
                          viewBox="0 0 24 24">
                          <path
                            fill="none"
                            stroke="currentColor"
                            stroke-linecap="round"
                            stroke-width="1.5"
                            d="M20.5 6h-17m5.67-2a3.001 3.001 0 0 1 5.66 0m3.544 11.4c-.177 2.654-.266 3.981-1.131 4.79s-2.195.81-4.856.81h-.774c-2.66 0-3.99 0-4.856-.81c-.865-.809-.953-2.136-1.13-4.79l-.46-6.9m13.666 0l-.2 3"
                          />
                        </svg>
                      </a>
                    </div>
                  </td>

                </tr>
              </tbody>
            </table>
          </div>

        </div>
      </div>

    </main>
  </section>
</div>
